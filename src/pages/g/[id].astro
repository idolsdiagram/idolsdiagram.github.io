---
import Diagram from "../../components/Diagram.astro";
import Layout from "../../components/Layout.astro";
import Nav from "../../components/Nav.astro";
import SpotifyPlayer from "../../components/SpotifyPlayer.astro";
import { groupJson } from "../../lib/GroupJson";
import { decode } from "../../lib/decode";
import { encode } from "../../lib/encode";
import { spotifyJson } from "../../lib/spotifyJson";

export const getStaticPaths = async () => {
  const paths = await Promise.all(
    Object.entries(groupJson.data).map(([key, value]) => ({
      params: { id: encode(key) },
      props: { 
        related: [...value],
        spotify: spotifyJson.find((artist) => artist.key === key) || null,
      },
    }))
  );
  return paths;
};
const { id } = Astro.params;
const {
  related,
  spotify,
}: {
  related: string[];
  spotify?: {
    key: string;
    name: string;
    id: string;
    popularity: number;
    followers: number;
  } | null;
} = Astro.props;
---

<Layout title={decode(id)}>
  <Nav id={decode(id)} />
  <main class="small-padding">
    <h6 class="s left-align">{decode(id)}</h6>
    <h6 class="m l center-align">{decode(id)}</h6>
    <div class="tabs no-margin">
      <a data-ui="#page1" class="active">
        <i
          ><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"
            ><!--!Font Awesome Free v7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.-->
            <path
              d="M112 144L112 240L208 240L208 144L112 144zM64 144C64 117.5 85.5 96 112 96L208 96C234.5 96 256 117.5 256 144L256 168L384 168L384 144C384 117.5 405.5 96 432 96L528 96C554.5 96 576 117.5 576 144L576 240C576 266.5 554.5 288 528 288L432 288C405.5 288 384 266.5 384 240L384 216L256 216L256 240C256 250.4 252.7 260.1 247 268L310 352L400 352C426.5 352 448 373.5 448 400L448 496C448 522.5 426.5 544 400 544L304 544C277.5 544 256 522.5 256 496L256 400C256 389.6 259.3 379.9 265 372L202 288L112 288C85.5 288 64 266.5 64 240L64 144zM304 400L304 496L400 496L400 400L304 400zM528 144L432 144L432 240L528 240L528 144z"
            ></path></svg
          ></i
        >
        <span>Diagram</span>
      </a>
      { spotify ?
      <a data-ui="#page2">
        <i><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><!--!Font Awesome Free v7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M320 72C183 72 72 183 72 320C72 457 183 568 320 568C457 568 568 457 568 320C568 183 457 72 320 72zM420.7 436.9C416.5 436.9 413.9 435.6 410 433.3C347.6 395.7 275 394.1 203.3 408.8C199.4 409.8 194.3 411.4 191.4 411.4C181.7 411.4 175.6 403.7 175.6 395.6C175.6 385.3 181.7 380.4 189.2 378.8C271.1 360.7 354.8 362.3 426.2 405C432.3 408.9 435.9 412.4 435.9 421.5C435.9 430.6 428.8 436.9 420.7 436.9zM447.6 371.3C442.4 371.3 438.9 369 435.3 367.1C372.8 330.1 279.6 315.2 196.7 337.7C191.9 339 189.3 340.3 184.8 340.3C174.1 340.3 165.4 331.6 165.4 320.9C165.4 310.2 170.6 303.1 180.9 300.2C208.7 292.4 237.1 286.6 278.7 286.6C343.6 286.6 406.3 302.7 455.7 332.1C463.8 336.9 467 343.1 467 351.8C466.9 362.6 458.5 371.3 447.6 371.3zM478.6 295.1C473.4 295.1 470.2 293.8 465.7 291.2C394.5 248.7 267.2 238.5 184.8 261.5C181.2 262.5 176.7 264.1 171.9 264.1C158.7 264.1 148.6 253.8 148.6 240.5C148.6 226.9 157 219.2 166 216.6C201.2 206.3 240.6 201.4 283.5 201.4C356.5 201.4 433 216.6 488.9 249.2C496.7 253.7 501.8 259.9 501.8 271.8C501.8 285.4 490.8 295.1 478.6 295.1z"/></svg></i>
        <span>Spotify</span>
      </a>
      : null}
    </div>
    <div class="page active" id="page1">
      <Diagram id={id} related={related} />
    </div>
    <div class="page" id="page2">
      <SpotifyPlayer
        data={spotify
          ? {
              id: spotify.id,
              popularity: spotify.popularity,
              followers: spotify.followers,
            }
          : null}
      />
    </div>
  </main>
</Layout>
